<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="ADMIN_CSS/font.css">
    <link rel="stylesheet" href="ADMIN_CSS/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="ADMIN_LIB/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="ADMIN_JS/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .first-div{
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .second-div{
            margin-left: 40px;
        }
        .third-div{
            margin-left: 40px;
        }
        .four-div{
            margin-left: 40px;
        }
    </style>
</head>

<body>
<div class="x-nav">
    <a class="layui-btn" lay-submit="" lay-filter="add" href="{:url('index')}">返回</a>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>
<div class="x-body">
    <form action="" method="post" class="layui-form layui-form-pane" id="form">
        <div class="layui-form-item">
            <label for="name" class="layui-form-label">
                <span class="x-red">*</span>角色名
            </label>
            <label for="name" class="layui-form-label">
                <span class="x-red">{$roleInfo.role_name}</span>
            </label>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">
                拥有权限
            </label>
            <div>
                {volist name='menus' id='v'}
                <div class="first-div-{$v.id} first-div">
                    {in name="v.id" value="$roleInfo['menu_ids']"}
                    <input type="checkbox" value="{$v.id}"  name="menu_ids[]" checked="checked" lay-filter="first">{$v.menu_name}
                    {else/}
                    <input type="checkbox" value="{$v.id}"  name="menu_ids[]" lay-filter="first">{$v.menu_name}
                    {/in}
                    {volist name='v.children' id='vv'}
                    <div class="second-div-{$v.id} second-div">
                        {in name="vv.id" value="$roleInfo['menu_ids']"}
                        <input type="checkbox" value="{$vv.id}" name="menu_ids[]" checked="checked" lay-filter="second">{$vv.menu_name}
                        {else/}
                        <input type="checkbox" value="{$vv.id}" name="menu_ids[]" lay-filter="second">{$vv.menu_name}
                        {/in}
                        {volist name='vv.children' id='vvv'}
                        <div class="third-div-{$v.id} third-div">
                            {in name="vvv.id" value="$roleInfo['menu_ids']"}
                            <input type="checkbox" value="{$vvv.id}" name="menu_ids[]" checked="checked" lay-filter="third">{$vvv.menu_name}
                            {else/}
                            <input type="checkbox" value="{$vvv.id}" name="menu_ids[]" lay-filter="third">{$vvv.menu_name}
                            {/in}
                            {volist name='vvv.children' id='vvvv'}
                            <div class="four-div-{$v.id} four-div">
                                {in name="vvvv.id" value="$roleInfo['menu_ids']"}
                                <input type="checkbox" value="{$vvvv.id}" name="menu_ids[]" checked="checked" lay-filter="third">{$vvvv.menu_name}
                                {else/}
                                <input type="checkbox" value="{$vvvv.id}" name="menu_ids[]" lay-filter="four">{$vvvv.menu_name}
                                {/in}
                            </div>
                            {/volist}
                        </div>
                        {/volist}
                    </div>
                    {/volist}
                </div>
                {/volist}

            </div>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="add" id="submit-btn">分配权限</button>
        </div>
    </form>
</div>
<script>
    layui.use(['form','layer'], function(){
        var form = layui.form
            ,$ = layui.jquery;
        form.on('checkbox(first)', function(data){
            var value = data.value;
            var status = data.elem.checked;
            if(status){
                //一级被选中，下级全部选中
                console.log(1);
                $('.second-div-' + value).find('input').each(function (i,v) {
                    $(v).attr('checked',true);
                    layui.use('form', function(){  //此段代码必不可少
                        var form = layui.form;
                        form.render();
                    });
                });
            }else {
                //一级被取消，则下级全部被取消
                $('.second-div-' + value).find('input').each(function (i,v) {
                    $(v).attr('checked',false);
                    layui.use('form', function(){  //此段代码必不可少
                        var form = layui.form;
                        form.render();
                    });
                });
                // console.log($('.second-div-' + value).find('input'));
            }

        });

    });




</script>
<script>
    $('#submit-btn').click(function(){
        var data = $('form').serializeArray();
        console.log(data);
        var role_id = "{$roleInfo['id']}";
        $.ajax({
            url:'distribute',
            type:'post',
            data:{'data':data,'role_id':role_id},
            dataType:'json',
            success:function(msg){
                // console.log(msg);
                if(msg.status == '1'){

                }else{
                    alert('分配失败');
                }

            }
        });
    });
</script>

</body>

</html>